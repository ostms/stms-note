# このサイトで使ったJSのきろく

※このメモサイトの例にならって、視認性のため、変数を日本語で表記します。

## 📌メモをクリックでモーダルウィンドウに表示

各メモは`section`タグで作成してある。
htmlの一番下にモーダル用のフルサイズブロックを用意しておく。
（自然と一番上に重なるのでらく）
```html
<section>
	・メモ内容…
...
<div id="modal">
```

```js
const セクション = document.getElementsByTagName('section');
	// クリック対象にするため全てのsectionを取得
const モーダル = document.getElementById('modal');
	// モーダルウィンドウのidを取得
```

### 取得したいずれかの要素を対象にしたい
全ての`section`を監視対象にする場合は `for` や `forEach` で全チェックするしかないようだ？
もっといい方法があれば知りたいが…
> querySelector系は`forEach`と`for`、それ以外は`for`しかつかえないもよう。

```js
for (let i=0; i < セクション.length; i++) {
// セクションの数だけ繰り返す
	セクション[i].addEventListener('click', () => {
	// セクションのどれかがクリックされたら → 関数
		let 一時 = セクション[i].cloneNode(true);
		// クリックされたセクションを複製する ※1
		モーダル.appendChild(一時);
		// モーダル要素の中に追加する
		モーダル.classList.add('open');
		// モーダル表示のためクラスを付与する
	});
}
```

### 複製しないと元の要素は消える
html内の要素は一個ずつきちんと管理されているようで、取得したものをあっちに表示させたいと適当にすると、元の場所から要素が消失する。
移動させたい場合はいいだろうけど……、モーダルに出す場合は **cloneNode** を使うのがいいのかな

## 📌表示されたモーダルを閉じたい
1. 表示されてる大メモはコピペしたいこともあるから、クリックしでも閉じないでほしい
   つまり<mark>要素外をクリックしたときだけ消えてほしい</mark>
   **→ `closest === null` で対象外のときを指定できる**
2. アニメで滑らかに消したいけど、大メモ自身を削除しないとモーダル内にたまってしまう。
   **→ setTimeoutで時間を置いて消そう。**

```js
モーダル.addEventListener('click', (イベント)=>{

	let 中身 = '#modal > section';
	// 何度も操作するのでこの文字列を変数にいれとく

	if(イベント.target.closest(中身) === null){
	// closestは対象の祖先要素とかをセレクタで指定できるもの。
	// これのnull(対象外)のときを利用してモーダルを消す
		モーダル.classList.remove('open');
		// モーダルからopenクラスを削除
		let 中身のセクション = document.querySelector(中身);
		// 消すとき時間をおきたいのでsetTimeoutのために要素取得してる？
		let 削除 = ()=>{
			モーダル.removeChild(中身のセクション);
			// モーダルから削除する関数を作成しておく
		};
		setTimeout(削除, 400);
		// 0.4秒おいたのち、要素は削除される。
	}
});
```
### 開いたモーダルの外をクリックして消したい
`.closest("CSSセレクタ")`は、対象(**自身も含む**)の親や祖先要素を探すためにつかうもの。
("CSSセレクタ")が見つかるまで探し、なければ`null`の値が帰ってくる。
`クリックされた自身.closest(自身)` とすれば、自身以外がクリックされたとき必ず`null`が返ってくるためIFの条件を満たす。
このテクニックは他にもいろいろ使うことができそう。

### アニメーション動作のため時間を置いて消したかった
クリックしてクラスremove。だと、`transition`とかで設定してるイージングも関係なく要素が消失するので…
JSで`setTimeout`を使って、CSSアニメーションの時間分まってから要素を消すようにした。

### 前半と後半で機能が違うので関数を分けてもいいかも
今回はこの動きをワンセットでほしかったので、モーダルクリックを起点とした直書きにしたけど、直書きはあまりよくないな…
この動きを再利用するなら、`let 中身`を関数の引数にして使えるだろうし、
時間を置いて消す部分を別関数に分けた方が、機能が見やすい気がする。